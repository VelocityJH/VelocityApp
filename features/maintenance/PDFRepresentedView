import SwiftUI
import PDFKit

struct PDFKitRepresentedView: UIViewRepresentable {
    let document: PDFDocument
    let searchTerm: String?

    class Coordinator {
        var matches: [PDFSelection] = []
        var currentIndex = 0
    }

    func makeCoordinator() -> Coordinator {
        Coordinator()
    }

    func makeUIView(context: Context) -> PDFView {
        let pdfView = PDFView()
        pdfView.document = document
        pdfView.autoScales = true

        if let searchTerm = searchTerm {
            DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) {
                context.coordinator.matches = document.findString(searchTerm, withOptions: .caseInsensitive)
                if let firstMatch = context.coordinator.matches.first {
                    pdfView.go(to: firstMatch)
                    pdfView.setCurrentSelection(firstMatch, animate: true)
                    pdfView.highlightedSelections = context.coordinator.matches
                }
            }
        }

        return pdfView
    }

    func updateUIView(_ pdfView: PDFView, context: Context) {
        // Optional: hook up UI buttons to navigate matches
    }
}